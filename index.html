<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusType: King's Ladder</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --highlight: #3b82f6;
            --correct: #10b981;
            --error: #ef4444;
            
            /* Rank Colors */
            --bronze: #cd7f32;
            --silver: #94a3b8;
            --gold: #f59e0b;
            --platinum: #06b6d4;
            --diamond: #8b5cf6;
            --king: #e11d48; /* Rose Red for King */
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        /* Header & Rank Info */
        .header-section {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 900px;
        }

        .rank-badge-container {
            background: var(--card-bg);
            padding: 15px 30px;
            border-radius: 50px;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-top: 10px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .rank-badge-container.is-king {
            border-color: #fbbf24;
            background: linear-gradient(to right, #fff1f2, #fff);
        }

        .rank-icon {
            width: 45px; height: 45px;
            border-radius: 50%;
            background: #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: white;
            font-size: 1.2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .rank-info {
            text-align: left;
            display: flex;
            flex-direction: column;
        }

        .rank-title { font-weight: 800; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; }
        .rank-points { font-size: 0.9rem; color: var(--text-sub); }

        /* Race Track */
        .race-track {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 900px;
            margin-bottom: 20px;
        }

        .race-lane {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        .race-lane:last-child { margin-bottom: 0; }

        .lane-label {
            width: 100px;
            font-size: 0.9rem;
            font-weight: bold;
            text-align: right;
            margin-right: 15px;
            color: var(--text-sub);
        }
        
        .lane-bar-bg {
            flex-grow: 1;
            height: 10px;
            background-color: #e5e7eb;
            border-radius: 5px;
            overflow: hidden;
        }

        .lane-progress {
            height: 100%;
            width: 0%;
            border-radius: 5px;
            transition: width 0.3s ease-out;
        }

        /* Colors for Bots */
        .lane-user .lane-progress { background-color: var(--highlight); }
        .lane-bot1 .lane-progress { background-color: #ef4444; } 
        .lane-bot2 .lane-progress { background-color: #f59e0b; } 
        .lane-bot3 .lane-progress { background-color: #8b5cf6; } 

        .lane-user .lane-label { color: var(--highlight); font-weight: 900; font-size: 0.9rem;}

        /* Typing Area */
        .typing-area {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            text-align: center;
            position: relative;
            width: 100%;
            max-width: 900px;
        }

        .live-stats {
            display: flex; justify-content: space-between; margin-bottom: 15px;
            font-size: 0.9rem; color: var(--text-sub); font-weight: bold;
        }

        .word-box {
            height: 130px;
            overflow: hidden;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex; flex-wrap: wrap; align-content: flex-start;
            line-height: 2.5rem;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.4rem;
            background: #fafafa;
            cursor: text;
        }

        .word { margin-right: 12px; padding: 2px 5px; border-radius: 4px; color: #9ca3af; }
        .word.active { background-color: #e0e7ff; color: var(--text-main); border-bottom: 2px solid var(--highlight); }
        .word.correct { color: var(--correct); }
        .word.incorrect { color: var(--error); text-decoration: line-through; }

        input#type-input {
            width: 100%; padding: 15px; font-size: 1.2rem;
            border: 2px solid #d1d5db; border-radius: 8px; outline: none;
            font-family: 'Courier New', Courier, monospace;
            transition: border-color 0.2s;
        }
        input#type-input:focus { border-color: var(--highlight); }
        input#type-input.input-error { background-color: #fef2f2; border-color: var(--error); }

        /* Results Modal */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.98);
            border-radius: 12px;
            display: none;
            flex-direction: column; align-items: center; justify-content: center;
            z-index: 10;
        }
        .modal-overlay.visible { display: flex; }

        .result-title { font-size: 2.2rem; font-weight: 800; margin-bottom: 5px; }
        .result-sub { color: var(--text-sub); margin-bottom: 20px; }

        .rp-change {
            font-size: 3rem; font-weight: 900;
            margin: 5px 0;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .rp-plus { color: var(--correct); }
        .rp-minus { color: var(--error); }

        .accuracy-note {
            font-size: 0.9rem; font-weight: bold;
            padding: 6px 15px; border-radius: 6px;
            margin-bottom: 20px;
        }
        .acc-bonus { background: #d1fae5; color: #065f46; }
        .acc-penalty { background: #fee2e2; color: #991b1b; }
        .acc-fatal { background: #7f1d1d; color: #fecaca; border: 2px solid #991b1b; }

        .stats-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat-mini { text-align: center; }
        .stat-mini span { display: block; font-weight: bold; font-size: 1.2rem; }
        .stat-mini label { font-size: 0.75rem; color: var(--text-sub); text-transform: uppercase; }

        button.btn-primary {
            background-color: var(--highlight); color: white; border: none;
            padding: 12px 30px; font-size: 1rem; border-radius: 6px;
            cursor: pointer; font-weight: bold; transition: background 0.2s;
        }
        button.btn-primary:hover { background-color: #2563eb; }

        .btn-reset {
            margin-top: 20px; font-size: 0.8rem; color: #999; background: none; border: none; cursor: pointer; text-decoration: underline;
        }

    </style>
</head>
<body>

    <div class="header-section">
        <h1>FocusType <span style="color:var(--highlight)">Ranked</span></h1>
        <div class="rank-badge-container" id="rank-badge-container">
            <div class="rank-icon" id="rank-icon">-</div>
            <div class="rank-info">
                <div class="rank-title" id="rank-name">Placement</div>
                <div class="rank-points" id="rank-details">Play 1 game to calibrate</div>
            </div>
        </div>
    </div>

    <div class="race-track">
        <div class="race-lane lane-user">
            <div class="lane-label">YOU</div>
            <div class="lane-bar-bg"><div class="lane-progress" id="prog-user" style="width: 0%"></div></div>
        </div>
        <div class="race-lane lane-bot1">
            <div class="lane-label" id="label-bot1">Ben</div>
            <div class="lane-bar-bg"><div class="lane-progress" id="prog-bot1" style="width: 0%"></div></div>
        </div>
        <div class="race-lane lane-bot2">
            <div class="lane-label" id="label-bot2">Quail</div>
            <div class="lane-bar-bg"><div class="lane-progress" id="prog-bot2" style="width: 0%"></div></div>
        </div>
        <div class="race-lane lane-bot3">
            <div class="lane-label" id="label-bot3">Teddy</div>
            <div class="lane-bar-bg"><div class="lane-progress" id="prog-bot3" style="width: 0%"></div></div>
        </div>
    </div>

    <div class="typing-area">
        <div class="live-stats">
            <span id="progress-text">0 / 20</span>
            <span id="timer-text">00:00</span>
        </div>

        <div class="word-box" id="word-box" onclick="document.getElementById('type-input').focus()"></div>

        <input type="text" id="type-input" placeholder="Type the words here..." autocomplete="off" spellcheck="false">

        <div id="results-modal" class="modal-overlay">
            <div class="result-title" id="res-title">Finished!</div>
            <div class="result-sub" id="res-sub">Calculating rank update...</div>
            
            <div class="rp-change" id="res-rp-change"></div>
            <div id="res-acc-note" style="display:none;"></div>

            <div class="stats-row">
                <div class="stat-mini">
                    <span id="res-wpm">0</span> <label>WPM</label>
                </div>
                <div class="stat-mini">
                    <span id="res-acc">0%</span> <label>Accuracy</label>
                </div>
                <div class="stat-mini">
                    <span id="res-rank">#</span> <label>Place</label>
                </div>
            </div>

            <button class="btn-primary" onclick="initGame()">Next Match</button>
        </div>
    </div>

    <button class="btn-reset" onclick="resetData()">[Reset Progress & Data]</button>

    <script>
        // --- 1. Configuration ---
        const SESSION_LENGTH = 20;
        const wordPool = [
            "really", "family", "school", "always", "result", "change", "reason", "person", "moment", "father",
            "report", "course", "mother", "period", "center", "figure", "system", "better", "minute", "friend",
            "street", "letter", "within", "market", "record", "effect", "action", "police", "office", "matter",
            "health", "myself", "ground", "expect", "strong", "common", "series", "amount", "growth", "answer",
            "leader", "energy", "public", "remain", "policy", "theory", "detail", "design", "player", "little",
            "people", "should", "before", "number", "follow", "create", "happen", "during", "appear", "travel",
            "future", "simple", "summer", "winter", "season", "spring", "dinner", "doctor", "sister", "animal",
            "listen", "charge", "member", "memory", "method", "camera", "weight", "window", "writer", "yellow",
            "garden", "global", "manage", "notice", "object", "option", "orange", "parent", "party", "reduce",
            "because", "through", "between", "student", "country", "another", "program", "problem", "service", "against",
            "company", "provide", "however", "develop", "without", "general", "present", "council", "example", "already",
            "process", "suggest", "support", "control", "whether", "product", "history", "himself", "believe", "subject",
            "receive", "quality", "special", "picture", "college", "certain", "teacher", "perhaps", "society", "morning",
            "private", "include", "section", "several", "project", "nothing", "measure", "message", "benefit", "account",
            "century", "success", "perform", "kitchen", "address", "culture", "trouble", "capital", "popular", "produce",
            "situation", "level", "image", "itself", "nature", "likely", "office", "federal", "couple", "social",
            "question", "business", "anything", "decision", "building", "southern", "computer", "hospital", "security", "personal",
            "industry", "interest", "activity", "position", "practice", "evidence", "describe", "director", "response", "campaign",
            "material", "daughter", "congress", "analysis", "movement", "physical", "behavior", "increase", "standard", "remember",
            "consider", "actually", "learning", "research", "military", "resource", "language", "specific", "everyone", "training"
        ];

        const RANKS = [
            { name: "Bronze", minRP: 0, color: "var(--bronze)", baseWPM: 10, wpmRange: 30, rpRange: 200 },   // 0-199 RP, 10-40 WPM
            { name: "Silver", minRP: 200, color: "var(--silver)", baseWPM: 40, wpmRange: 30, rpRange: 200 }, // 200-399 RP, 40-70 WPM
            { name: "Gold", minRP: 400, color: "var(--gold)", baseWPM: 70, wpmRange: 30, rpRange: 200 },     // 400-599 RP, 70-100 WPM
            { name: "Platinum", minRP: 600, color: "var(--platinum)", baseWPM: 100, wpmRange: 20, rpRange: 200 }, // 600-799 RP, 100-120 WPM
            { name: "Diamond", minRP: 800, color: "var(--diamond)", baseWPM: 120, wpmRange: 20, rpRange: 200 },   // 800-999 RP, 120-140 WPM
            { name: "King", minRP: 1000, color: "var(--king)", baseWPM: 141, wpmRange: 50, rpRange: 1000 }        // 1000+, 141+
        ];

        let currentWords = [];
        let currentIndex = 0;
        let startTime = null;
        let timerInterval = null;
        let gameActive = false;
        let totalKeystrokes = 0;
        let totalMistakes = 0;
        
        let bots = [];
        let botTimers = [];
        let userRP = null; 

        // --- Helper: Calculate Ladder WPM based on RP ---
        function getLadderWPM(rp) {
            if (rp < 200) return 10 + (rp / 200) * 30; // Bronze
            if (rp < 400) return 40 + ((rp - 200) / 200) * 30; // Silver
            if (rp < 600) return 70 + ((rp - 400) / 200) * 30; // Gold
            if (rp < 800) return 100 + ((rp - 600) / 200) * 20; // Plat
            if (rp < 1000) return 120 + ((rp - 800) / 200) * 20; // Diamond
            return 141 + ((rp - 1000) / 100) * 10; // King (slow scaling)
        }

        // --- Helper: Calculate RP based on WPM (Inverse for Placement) ---
        function getRPFromWPM(wpm) {
            if (wpm < 40) return ((wpm - 10) / 30) * 200; // Bronze
            if (wpm < 70) return 200 + ((wpm - 40) / 30) * 200; // Silver
            if (wpm < 100) return 400 + ((wpm - 70) / 30) * 200; // Gold
            if (wpm < 120) return 600 + ((wpm - 100) / 20) * 200; // Plat
            if (wpm < 140) return 800 + ((wpm - 120) / 20) * 200; // Diamond
            return 1000; // King Cap for placement
        }

        function loadUserData() {
            const storedRP = localStorage.getItem('focusType_RP');
            if (storedRP !== null) {
                userRP = parseInt(storedRP, 10);
            } else {
                userRP = null; 
            }
            updateRankDisplay();
        }

        function getRankInfo(rp) {
            if (rp === null) return { name: "Placement", color: "#999", next: 0 };
            for (let i = RANKS.length - 1; i >= 0; i--) {
                if (rp >= RANKS[i].minRP) {
                    const nextRank = RANKS[i+1] ? RANKS[i+1].minRP : "MAX";
                    return { ...RANKS[i], next: nextRank };
                }
            }
            return RANKS[0];
        }

        function updateRankDisplay() {
            const rank = getRankInfo(userRP);
            const containerEl = document.getElementById('rank-badge-container');
            const iconEl = document.getElementById('rank-icon');
            const nameEl = document.getElementById('rank-name');
            const detailEl = document.getElementById('rank-details');

            // Reset special class
            containerEl.classList.remove('is-king');

            if (userRP === null) {
                iconEl.style.background = "#555";
                iconEl.innerText = "?";
                nameEl.innerText = "PLACEMENT MATCH";
                nameEl.style.color = "#555";
                detailEl.innerText = "Play 1 game to rank";
            } else {
                iconEl.style.background = rank.color;
                iconEl.innerText = rank.name === "King" ? "K" : rank.name[0];
                nameEl.innerText = rank.name;
                nameEl.style.color = rank.color;
                
                if(rank.name === "King") {
                    containerEl.classList.add('is-king');
                    detailEl.innerText = `${userRP} RP (Legendary)`;
                } else {
                    detailEl.innerText = `${userRP} RP` + (rank.next !== "MAX" ? ` / ${rank.next} for Promotion` : "");
                }
            }
        }

        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function initGame() {
            loadUserData();
            
            currentWords = shuffle(wordPool).slice(0, SESSION_LENGTH);
            currentIndex = 0;
            startTime = null;
            totalKeystrokes = 0;
            totalMistakes = 0;
            gameActive = false;
            if(timerInterval) clearInterval(timerInterval);

            document.getElementById('type-input').value = '';
            document.getElementById('type-input').disabled = false;
            document.getElementById('type-input').focus();
            document.getElementById('type-input').classList.remove('input-error');
            document.getElementById('results-modal').classList.remove('visible');
            document.getElementById('res-acc-note').style.display = 'none';
            document.getElementById('progress-text').innerText = `0 / ${SESSION_LENGTH}`;
            document.getElementById('timer-text').innerText = "00:00";
            
            const wb = document.getElementById('word-box');
            wb.innerHTML = '';
            currentWords.forEach((w, i) => {
                const s = document.createElement('span');
                s.className = i === 0 ? 'word active' : 'word';
                s.innerText = w;
                wb.appendChild(s);
            });
            wb.scrollTop = 0;

            setupBots();
        }

        function setupBots() {
            botTimers.forEach(t => clearTimeout(t));
            botTimers = [];
            
            ['user', 'bot1', 'bot2', 'bot3'].forEach(k => {
                document.getElementById(`prog-${k}`).style.width = '0%';
            });

            let botSpeeds = [];
            const botNames = ["Ben", "Quail", "Teddy"];

            if (userRP === null) {
                // FIXED PLACEMENT SPEEDS
                botSpeeds = [15, 30, 45]; 
            } else {
                // RANKED MODE
                const ladderWPM = getLadderWPM(userRP);
                botSpeeds = [
                    Math.floor(ladderWPM * 0.85), 
                    Math.floor(ladderWPM * 1.0), 
                    Math.floor(ladderWPM * 1.15)
                ];
            }

            bots = botSpeeds.map((wpm, i) => ({
                id: `bot${i+1}`,
                element: document.getElementById(`prog-bot${i+1}`),
                wpm: Math.max(5, wpm), // Safety floor
                progress: 0,
                finished: false
            }));

            botNames.forEach((name, i) => {
                document.getElementById(`label-bot${i+1}`).innerText = name;
            });
        }

        function startBots() {
            bots.forEach((bot, i) => scheduleBotWord(i));
        }

        function scheduleBotWord(botIndex) {
            if (!gameActive) return;
            const bot = bots[botIndex];
            
            if (bot.progress >= SESSION_LENGTH) {
                bot.finished = true;
                return;
            }

            let baseDelay = 60000 / bot.wpm;
            let variance = (Math.random() * 0.6) + 0.7; 
            let actualDelay = baseDelay * variance;

            if (Math.random() < 0.10) actualDelay += 1500;

            const tid = setTimeout(() => {
                if (!gameActive) return;
                bot.progress++;
                bot.element.style.width = `${(bot.progress / SESSION_LENGTH)*100}%`;
                scheduleBotWord(botIndex);
            }, actualDelay);
            
            botTimers.push(tid);
        }

        const inputEl = document.getElementById('type-input');
        
        inputEl.addEventListener('input', (e) => {
            if (!startTime && e.target.value.length > 0) {
                gameActive = true;
                startTime = new Date();
                timerInterval = setInterval(() => {
                    const diff = Math.floor((new Date() - startTime) / 1000);
                    const m = Math.floor(diff/60).toString().padStart(2,'0');
                    const s = (diff%60).toString().padStart(2,'0');
                    document.getElementById('timer-text').innerText = `${m}:${s}`;
                }, 1000);
                startBots();
            }

            const typed = e.target.value;
            const target = currentWords[currentIndex];
            totalKeystrokes++;

            if (target.startsWith(typed.trim())) {
                inputEl.classList.remove('input-error');
            } else {
                inputEl.classList.add('input-error');
                totalMistakes++;
            }
        });

        inputEl.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                if (!gameActive) return;

                const val = inputEl.value.trim();
                const target = currentWords[currentIndex];
                const spans = document.querySelectorAll('.word');

                if (val.length > 0) {
                    if (val === target) {
                        spans[currentIndex].classList.add('correct');
                    } else {
                        spans[currentIndex].classList.add('incorrect');
                    }
                    spans[currentIndex].classList.remove('active');

                    currentIndex++;
                    document.getElementById('prog-user').style.width = `${(currentIndex/SESSION_LENGTH)*100}%`;
                    document.getElementById('progress-text').innerText = `${currentIndex} / ${SESSION_LENGTH}`;
                    
                    inputEl.value = '';
                    inputEl.classList.remove('input-error');

                    if (currentIndex >= SESSION_LENGTH) {
                        finishGame();
                    } else {
                        spans[currentIndex].classList.add('active');
                        spans[currentIndex].scrollIntoView({ behavior: "smooth", block: "center" });
                    }
                }
            }
        });

        function finishGame() {
            gameActive = false;
            clearInterval(timerInterval);
            botTimers.forEach(t => clearTimeout(t));
            inputEl.disabled = true;

            const endTime = new Date();
            const minutes = (endTime - startTime) / 60000;
            const totalChars = currentWords.join('').length + SESSION_LENGTH;
            const wpm = Math.round((totalChars / 5) / minutes);
            const accuracy = totalKeystrokes > 0 ? Math.round(((totalKeystrokes - totalMistakes)/totalKeystrokes)*100) : 0;

            let place = 1;
            bots.forEach(b => { if (b.progress >= SESSION_LENGTH) place++; });

            processResults(wpm, accuracy, place);
        }

        function processResults(wpm, accuracy, place) {
            const titleEl = document.getElementById('res-title');
            const subEl = document.getElementById('res-sub');
            const rpChangeEl = document.getElementById('res-rp-change');
            const accNoteEl = document.getElementById('res-acc-note');

            // UI Stats
            document.getElementById('res-acc').innerText = accuracy + "%";
            document.getElementById('res-rank').innerText = place;
            document.getElementById('res-wpm').innerText = wpm;

            accNoteEl.style.display = 'none';
            accNoteEl.className = 'accuracy-note';

            // === FATAL ACCURACY CHECK (< 60%) ===
            if (accuracy < 60) {
                if (userRP !== null) {
                    userRP = Math.max(0, userRP - 60);
                    localStorage.setItem('focusType_RP', userRP);
                }
                
                titleEl.innerText = "DISQUALIFIED";
                titleEl.style.color = "var(--error)";
                subEl.innerText = "Accuracy < 60%. Score invalid.";
                
                rpChangeEl.innerHTML = `<span class="rp-minus">-60 RP</span>`;
                
                document.getElementById('res-wpm').innerText = "---";
                document.getElementById('res-wpm').style.color = "#aaa";
                
                accNoteEl.innerText = "SUPER OUT OF CONTROL";
                accNoteEl.classList.add('acc-fatal');
                accNoteEl.style.display = 'inline-block';

                document.getElementById('results-modal').classList.add('visible');
                updateRankDisplay();
                return;
            }

            // === NORMAL FLOW ===

            if (userRP === null) {
                // Placement Calculation using new segments
                const effectiveWPM = Math.floor(wpm * (accuracy / 100) * 0.8);
                const calculatedRP = Math.floor(getRPFromWPM(effectiveWPM));
                
                userRP = Math.max(0, calculatedRP);
                localStorage.setItem('focusType_RP', userRP);

                titleEl.innerText = "Placement Complete!";
                titleEl.style.color = "var(--highlight)";
                subEl.innerText = `Effective WPM: ${effectiveWPM} (Initial Calib)`;
                rpChangeEl.innerHTML = `<span style="color:var(--highlight); font-size:1.5rem;">Rank: ${getRankInfo(userRP).name} (${userRP} RP)</span>`;
            
            } else {
                // Ranked Calculation
                let change = 0;
                if (place === 1) change = 30;
                else if (place === 2) change = 10;
                else if (place === 3) change = -10;
                else change = -30;

                // Accuracy Modifiers
                let accMod = 0;
                let accText = "";
                if (accuracy >= 95) {
                    accMod = 5;
                    accText = "High Precision +5 RP";
                    accNoteEl.classList.add('acc-bonus');
                } else if (accuracy < 90) {
                    accMod = -10;
                    accText = "Low Accuracy -10 RP";
                    accNoteEl.classList.add('acc-penalty');
                }

                if(accText) {
                    accNoteEl.innerText = accText;
                    accNoteEl.style.display = 'inline-block';
                }

                let totalChange = change + accMod;
                userRP += totalChange;
                if (userRP < 0) userRP = 0; 
                localStorage.setItem('focusType_RP', userRP);

                titleEl.innerText = place <= 2 ? "Victory!" : "Defeat";
                titleEl.style.color = place <= 2 ? "var(--correct)" : "var(--error)";
                
                const sign = totalChange >= 0 ? "+" : "";
                const colorClass = totalChange >= 0 ? "rp-plus" : "rp-minus";
                
                subEl.innerText = `(Place ${change > 0 ? '+'+change : change} | Acc ${accMod > 0 ? '+'+accMod : accMod})`;
                rpChangeEl.innerHTML = `<span class="${colorClass}">${sign}${totalChange} RP</span>`;
            }

            document.getElementById('results-modal').classList.add('visible');
            updateRankDisplay();
        }

        function resetData() {
            if(confirm("Reset all rank data? You will play a placement match next.")) {
                localStorage.removeItem('focusType_RP');
                location.reload();
            }
        }

        window.onload = initGame;

    </script>
</body>
</html>
